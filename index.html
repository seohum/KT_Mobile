<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KT 단말기 컨설팅</title>
<style>
:root{--bg:#f6f7fb;--card:#fff;--bd:#e9e9ee;--txt:#111;--muted:#666;}
body{margin:0;font-family:system-ui,-apple-system,"Noto Sans KR",sans-serif;background:var(--bg);color:var(--txt);}
header{background:#fff;border-bottom:1px solid var(--bd);position:sticky;top:0;z-index:10;}
.wrap{max-width:1180px;margin:0 auto;padding:16px;}
.top{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;}
.brand{font-weight:1100;letter-spacing:-0.3px;}
.controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;}
select{padding:10px 12px;border-radius:12px;border:1px solid var(--bd);background:#fff;}
.tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;}
.tab{border:1px solid var(--bd);background:#fff;padding:8px 12px;border-radius:999px;cursor:pointer;font-size:13px;color:#333;}
.tab.active{border-color:#111;color:#111;font-weight:1100;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:12px;margin-top:14px;}
.card{background:var(--card);border:1px solid var(--bd);border-radius:16px;padding:14px;cursor:pointer;}
.card:hover{border-color:#cfcfda;transform:translateY(-1px);transition:0.12s ease;}
.imgbox{width:100%;height:170px;border-radius:12px;background:#fafafa;display:flex;align-items:center;justify-content:center;overflow:hidden;border:1px solid #f0f0f4;}
.imgbox img{width:100%;height:100%;object-fit:contain;}
.cat{font-size:12px;color:var(--muted);margin-top:10px;}
.name{margin:6px 0 10px;font-weight:1100;letter-spacing:-0.3px;}
.line{font-size:13px;color:var(--muted);display:flex;justify-content:space-between;gap:10px;}
.pill{display:inline-block;margin-top:10px;font-size:12px;border:1px solid var(--bd);padding:6px 10px;border-radius:999px;background:#fff;color:#333;}
footer{padding:18px 0 40px;color:#777;font-size:12px;line-height:1.45;}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);}
.box{max-width:620px;margin:8vh auto;background:#fff;border-radius:18px;padding:16px;border:1px solid #ddd;}
.box h3{margin:0 0 8px;letter-spacing:-0.3px;}
.muted{color:var(--muted);font-size:13px;}
.rows{margin-top:12px;display:grid;gap:8px;}
.row{display:flex;justify-content:space-between;gap:10px;}
.row b{font-weight:1100;}
hr{border:none;border-top:1px solid var(--bd);margin:12px 0;}
.big{font-size:22px;font-weight:1200;letter-spacing:-0.4px;}
.actions{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap;}
.btn{flex:1;min-width:120px;text-align:center;padding:10px 12px;border-radius:14px;border:1px solid var(--bd);background:#fff;text-decoration:none;color:#111;cursor:pointer;}
.btn.primary{border-color:#111;font-weight:1100;}
.row select{padding:8px 10px;border-radius:10px;}
.warn{font-size:12px;color:#b45309;background:#fffbeb;border:1px solid #fef3c7;padding:8px 10px;border-radius:12px;}

.free{color:#d00;font-weight:1100;font-size:1.5em;}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="top">
      <div class="brand">KT 단말기 컨설팅</div>
      <div class="controls">
        <select id="joinType">
          <option value="change">기기변경</option>
          <option value="mnp">번호이동(MNP)</option>
          <option value="010">010신규</option>
        </select>

        <select id="discountType">
          <option value="gongsi">공시지원금</option>
          <option value="seonyak25">요금할인 25%(선택약정)</option>
        </select>

        <select id="months">
          <option value="24">24개월</option>
          <option value="30">30개월</option>
          <option value="36">36개월</option>
        </select>

        <select id="planTier">
          <option value="37000">37K 이상</option>
          <option value="61000">61K 이상</option>
          <option value="90000" selected>90K 이상</option>
          <option value="110000">110K 이상</option>
        </select>
      </div>
    </div>

    <div class="tabs" id="tabs"></div>
  </div>
</header>

<main class="wrap">
  <div id="grid" class="grid"></div>
  <footer>
    ※ 공시지원금 : <b>선택하신 요금제에 따라 지원금 변동</b> 요금제 구간(37/61/90/110) 선택<br/>
    ※ 특판가 : <b>프랜차이즈 및 법인 특가</b> (특별할인지원금)<br/>
    ※ 선택약정(요금할인 25%) 선택 시 공시지원금은 <b>표시되지 않습니다</b>.<br/>
    ※ 할부이자: 연 5.9%, 원리금균등 상환 기준(예상).<br/>
  </footer>
</main>

<div id="modal" class="modal" aria-hidden="true">
  <div class="box" role="dialog" aria-modal="true">
    <h3 id="mTitle">예상 월 납부금</h3>
    <div class="muted" id="mSub"></div>
    <div id="mWarn" class="warn" style="display:none;margin-top:10px;"></div>
    <div class="rows" id="mRows"></div>
    <hr/>
    <div class="big" id="mTotal"></div>
    <div class="actions">
      <a class="btn primary" href="https://kt-mns.com/" target="_blank">상담 신청</a>
      <a class="btn" href="tel:010-8871-3121">전화상담</a>
      <button class="btn" onclick="closeModal()">닫기</button>
    </div>
  </div>
</div>

<script>
const DEVICES = [{"groupId": "ip17", "name": "iPhone 17", "cat": "애플", "tab": "apple", "variants": [{"id": "ip17_256", "cap": "256GB", "modelCode": "AIP17-256", "msrp": 1287000, "특판가Code": "AIP17(P,PM)"}, {"id": "ip17_512", "cap": "512GB", "modelCode": "AIP17-512", "msrp": 1584000, "특판가Code": "AIP17(P,PM)"}]}, {"groupId": "ip17p", "name": "iPhone 17 Pro", "cat": "애플", "tab": "apple", "variants": [{"id": "ip17p_256", "cap": "256GB", "modelCode": "AIP17P-256", "msrp": 1782000, "특판가Code": "AIP17(P,PM)"}, {"id": "ip17p_512", "cap": "512GB", "modelCode": "AIP17P-512", "msrp": 2090000, "특판가Code": "AIP17(P,PM)"}, {"id": "ip17p_1t", "cap": "1TB", "modelCode": "AIP17P-1T", "msrp": 2387000, "특판가Code": "AIP17(P,PM)"}]}, {"groupId": "ip17pm", "name": "iPhone 17 Pro Max", "cat": "애플", "tab": "apple", "variants": [{"id": "ip17pm_256", "cap": "256GB", "modelCode": "AIP17PM-256", "msrp": 1980000, "특판가Code": "AIP17(P,PM)"}, {"id": "ip17pm_512", "cap": "512GB", "modelCode": "AIP17PM-512", "msrp": 2288000, "특판가Code": "AIP17(P,PM)"}, {"id": "ip17pm_1t", "cap": "1TB", "modelCode": "AIP17PM-1T", "msrp": 2585000, "특판가Code": "AIP17(P,PM)"}]}, {"groupId": "ipair", "name": "iPhone Air", "cat": "애플", "tab": "apple", "variants": [{"id": "ipair_256", "cap": "256GB", "modelCode": "AIPA-256", "msrp": 1584000, "특판가Code": "AIPA"}, {"id": "ipair_512", "cap": "512GB", "modelCode": "AIPA-512", "msrp": 1881000, "특판가Code": "AIPA"}, {"id": "ipair_1t", "cap": "1TB", "modelCode": "AIPA-1T", "msrp": 2189000, "특판가Code": "AIPA"}]}, {"groupId": "fold7", "name": "Galaxy Z Fold7", "cat": "폴더블", "tab": "foldable", "variants": [{"id": "fold7_256", "cap": "256GB", "modelCode": "SM-F966NK", "msrp": 2379300, "특판가Code": "SM-F966NK"}, {"id": "fold7_512", "cap": "512GB", "modelCode": "SM-F966NK512", "msrp": 2537700, "특판가Code": "SM-F966NK"}]}, {"groupId": "flip7", "name": "Galaxy Z Flip7", "cat": "폴더블", "tab": "foldable", "variants": [{"id": "flip7_256", "cap": "256GB", "modelCode": "SM-F766NK", "msrp": 1485000, "특판가Code": "SM-F766NK(O)"}, {"id": "flip7_512", "cap": "512GB", "modelCode": "SM-F766NK512", "msrp": 1643400, "특판가Code": "SM-F766NK(O)512G"}]}, {"groupId": "s25", "name": "Galaxy S25", "cat": "삼성", "tab": "sseries", "variants": [{"id": "s25_256", "cap": "256GB", "modelCode": "SM-S931NK", "msrp": 1155000, "특판가Code": "SM-S931(8)NK(O)_256G"}, {"id": "s25_512", "cap": "512GB", "modelCode": "SM-S931NK512", "msrp": 1298000, "특판가Code": "SM-S931(8)NK(O)_512G"}]}, {"groupId": "s25p", "name": "Galaxy S25 Plus", "cat": "삼성", "tab": "sseries", "variants": [{"id": "s25p_256", "cap": "256GB", "modelCode": "SM-S936NK", "msrp": 1353000, "특판가Code": "SM-S936NK(O)_256G"}, {"id": "s25p_512", "cap": "512GB", "modelCode": "SM-S936NK512", "msrp": 1496000, "특판가Code": "SM-S936NK(O)_512G"}]}, {"groupId": "s25u", "name": "Galaxy S25 Ultra", "cat": "삼성", "tab": "sseries", "variants": [{"id": "s25u_256", "cap": "256GB", "modelCode": "SM-S938NK", "msrp": 1698400, "특판가Code": null}, {"id": "s25u_512", "cap": "512GB", "modelCode": "SM-S938NK512", "msrp": 1841400, "특판가Code": null}]}, {"groupId": "s25e", "name": "Galaxy S25 Edge", "cat": "삼성", "tab": "sseries", "variants": [{"id": "s25e_256", "cap": "256GB", "modelCode": "SM-S937NK", "msrp": 1496000, "특판가Code": "SM-S937NK(O)"}, {"id": "s25e_512", "cap": "512GB", "modelCode": "SM-S937NK512", "msrp": 1639000, "특판가Code": "SM-S937NK(O)512G"}]}, {"groupId": "s25fe", "name": "Galaxy S25 FE", "cat": "삼성", "tab": "sseries", "variants": [{"id": "s25fe", "cap": "256GB", "modelCode": "SM-S731NK", "msrp": 946000, "특판가Code": "SM-S731NK(O)"}]}, {"groupId": "jump4", "name": "Galaxy Jump4", "cat": "삼성 보급형", "tab": "budget", "variants": [{"id": "jump4", "cap": "", "modelCode": "SM-M366K", "msrp": 449900, "특판가Code": "SM-M366K"}], "gift": 140000}, {"groupId": "a36", "name": "Galaxy A36", "cat": "삼성 보급형", "tab": "budget", "variants": [{"id": "a36", "cap": "", "modelCode": "SM-A366NK", "msrp": 499400, "특판가Code": "SM-A366NK"}], "gift": 140000}, {"groupId": "a17", "name": "Galaxy A17", "cat": "삼성 보급형", "tab": "budget", "variants": [{"id": "a17", "cap": "", "modelCode": "SM-A175NK", "msrp": 319000, "특판가Code": "SM-A175NK(O)"}], "gift": 110000}, {"groupId": "pompom", "name": "폼폼푸린 키즈폰", "cat": "삼성 보급형", "tab": "budget", "variants": [{"id": "pompom", "cap": "", "modelCode": "SM-A175NK-KP", "msrp": 349800, "특판가Code": "SM-A175NK-KP"}], "gift": 50000}];
const GONGSI_BY_MODEL = {"AIP17-256": {"37000": 248000, "61000": 550000, "90000": 550000, "110000": 550000}, "AIP17-512": {"37000": 248000, "61000": 550000, "90000": 550000, "110000": 550000}, "AIP17P-1T": {"37000": 248000, "61000": 550000, "90000": 550000, "110000": 550000}, "AIP17P-256": {"37000": 248000, "61000": 550000, "90000": 550000, "110000": 550000}, "AIP17P-512": {"37000": 248000, "61000": 550000, "90000": 550000, "110000": 550000}, "AIP17PM-1T": {"37000": 86000, "61000": 127000, "90000": 250000, "110000": 250000}, "AIP17PM-256": {"37000": 86000, "61000": 127000, "90000": 250000, "110000": 250000}, "AIP17PM-512": {"37000": 86000, "61000": 127000, "90000": 250000, "110000": 250000}, "AIPA-1T": {"37000": 248000, "61000": 550000, "90000": 550000, "110000": 550000}, "AIPA-256": {"37000": 248000, "61000": 550000, "90000": 550000, "110000": 550000}, "AIPA-512": {"37000": 248000, "61000": 550000, "90000": 550000, "110000": 550000}, "SM-A175NK": {"37000": 278000, "61000": 278000, "90000": 278000, "110000": 278000}, "SM-A175NK-KP": {"37000": 305000, "61000": 305000, "90000": 305000, "110000": 305000}, "SM-A366NK": {"37000": 435000, "61000": 435000, "90000": 435000, "110000": 435000}, "SM-F766NK": {"37000": 270000, "61000": 600000, "90000": 600000, "110000": 600000}, "SM-F766NK512": {"37000": 270000, "61000": 600000, "90000": 600000, "110000": 600000}, "SM-F966NK": {"37000": 270000, "61000": 600000, "90000": 600000, "110000": 600000}, "SM-F966NK512": {"37000": 270000, "61000": 600000, "90000": 600000, "110000": 600000}, "SM-M366K": {"37000": 392000, "61000": 392000, "90000": 392000, "110000": 392000}, "SM-S731NK": {"37000": 473000, "61000": 600000, "90000": 600000, "110000": 600000}, "SM-S931NK": {"37000": 270000, "61000": 600000, "90000": 600000, "110000": 600000}, "SM-S931NK512": {"37000": 270000, "61000": 600000, "90000": 600000, "110000": 600000}, "SM-S936NK": {"37000": 270000, "61000": 600000, "90000": 600000, "110000": 600000}, "SM-S936NK512": {"37000": 270000, "61000": 600000, "90000": 600000, "110000": 600000}, "SM-S937NK": {"37000": 270000, "61000": 600000, "90000": 600000, "110000": 600000}, "SM-S937NK512": {"37000": 270000, "61000": 600000, "90000": 600000, "110000": 600000}, "SM-S938NK": {"37000": 270000, "61000": 600000, "90000": 600000, "110000": 600000}, "SM-S938NK512": {"37000": 270000, "61000": 600000, "90000": 600000, "110000": 600000}};
const 특판가_BY_CODE = {"AIP17(P,PM)": {"110000": {"010": 420000, "mnp": 420000, "change": 310000}, "90000": {"010": 420000, "mnp": 420000, "change": 310000}, "61000": {"010": 420000, "mnp": 420000, "change": 90000}, "37000": {"010": 150000, "mnp": 150000, "change": 60000}}, "AIPA": {"110000": {"010": 420000, "mnp": 420000, "change": 410000}, "90000": {"010": 420000, "mnp": 420000, "change": 410000}, "61000": {"010": 420000, "mnp": 420000, "change": 90000}, "37000": {"010": 150000, "mnp": 150000, "change": 60000}}, "SM-A175NK(O)": {"110000": {"010": 270000, "mnp": 280000, "change": 160000}, "90000": {"010": 270000, "mnp": 280000, "change": 160000}, "61000": {"010": 270000, "mnp": 280000, "change": 160000}, "37000": {"010": 270000, "mnp": 280000, "change": 160000}}, "SM-A175NK-KP": {"110000": {"010": 290000, "mnp": 260000, "change": 100000}, "90000": {"010": 290000, "mnp": 260000, "change": 100000}, "61000": {"010": 290000, "mnp": 260000, "change": 100000}, "37000": {"010": 290000, "mnp": 260000, "change": 100000}}, "SM-A366NK": {"110000": {"010": 260000, "mnp": 270000, "change": 210000}, "90000": {"010": 260000, "mnp": 270000, "change": 210000}, "61000": {"010": 260000, "mnp": 270000, "change": 210000}, "37000": {"010": 150000, "mnp": 270000, "change": 60000}}, "SM-F766NK(O)": {"110000": {"010": 440000, "mnp": 620000, "change": 420000}, "90000": {"010": 440000, "mnp": 620000, "change": 420000}, "61000": {"010": 440000, "mnp": 620000, "change": 190000}, "37000": {"010": 240000, "mnp": 250000, "change": 160000}}, "SM-F766NK(O)512G": {"110000": {"010": 520000, "mnp": 700000, "change": 500000}, "90000": {"010": 520000, "mnp": 700000, "change": 500000}, "61000": {"010": 520000, "mnp": 700000, "change": 270000}, "37000": {"010": 320000, "mnp": 330000, "change": 240000}}, "SM-F966NK": {"110000": {"010": 450000, "mnp": 620000, "change": 420000}, "90000": {"010": 450000, "mnp": 620000, "change": 420000}, "61000": {"010": 450000, "mnp": 620000, "change": 190000}, "37000": {"010": 250000, "mnp": 250000, "change": 160000}}, "SM-M366K": {"110000": {"010": 260000, "mnp": 320000, "change": 210000}, "90000": {"010": 260000, "mnp": 320000, "change": 210000}, "61000": {"010": 260000, "mnp": 320000, "change": 210000}, "37000": {"010": 150000, "mnp": 320000, "change": 60000}}, "SM-S731NK(O)": {"110000": {"010": 360000, "mnp": 260000, "change": 250000}, "90000": {"010": 360000, "mnp": 260000, "change": 250000}, "61000": {"010": 360000, "mnp": 260000, "change": 180000}, "37000": {"010": 90000, "mnp": 160000, "change": 0}}, "SM-S931(8)NK(O)_256G": {"110000": {"010": 500000, "mnp": 600000, "change": 310000}, "90000": {"010": 500000, "mnp": 600000, "change": 310000}, "61000": {"010": 500000, "mnp": 600000, "change": 240000}, "37000": {"010": 300000, "mnp": 300000, "change": 210000}}, "SM-S931(8)NK(O)_512G": {"110000": {"010": 500000, "mnp": 600000, "change": 310000}, "90000": {"010": 500000, "mnp": 600000, "change": 310000}, "61000": {"010": 500000, "mnp": 600000, "change": 240000}, "37000": {"010": 300000, "mnp": 300000, "change": 210000}}, "SM-S936NK(O)_256G": {"110000": {"010": 500000, "mnp": 800000, "change": 510000}, "90000": {"010": 500000, "mnp": 800000, "change": 510000}, "61000": {"010": 500000, "mnp": 800000, "change": 240000}, "37000": {"010": 300000, "mnp": 300000, "change": 210000}}, "SM-S936NK(O)_512G": {"110000": {"010": 500000, "mnp": 800000, "change": 510000}, "90000": {"010": 500000, "mnp": 800000, "change": 510000}, "61000": {"010": 500000, "mnp": 800000, "change": 240000}, "37000": {"010": 300000, "mnp": 300000, "change": 210000}}, "SM-S937NK(O)": {"110000": {"010": 560000, "mnp": 610000, "change": 480000}, "90000": {"010": 560000, "mnp": 610000, "change": 480000}, "61000": {"010": 560000, "mnp": 610000, "change": 300000}, "37000": {"010": 360000, "mnp": 360000, "change": 270000}}, "SM-S937NK(O)512G": {"110000": {"010": 700000, "mnp": 750000, "change": 620000}, "90000": {"010": 700000, "mnp": 750000, "change": 620000}, "61000": {"010": 700000, "mnp": 750000, "change": 440000}, "37000": {"010": 500000, "mnp": 500000, "change": 410000}}};

// 할부: 연 5.9% 원리금균등
const APR = 0.059;
function pmtEqualPayment(principal, months, apr){
  if (principal <= 0) return 0;
  const r = apr / 12;
  if (r === 0) return principal / months;
  const pow = Math.pow(1 + r, months);
  return principal * r * pow / (pow - 1);
}

function won(n){ return Math.round(n).toLocaleString("ko-KR") + "원"; }

function fmtNetPrice(value){
  // 실구매가가 0 이하이면 0원 처리 + 무료 강조 표시
  const v = Math.max(0, Math.round(value));
  if (v === 0){
    return `<span class="free">0원(무료)</span>`;
  }
  return won(v);
}

function joinLabel(v){ return v==="change" ? "기기변경" : v==="mnp" ? "번호이동(MNP)" : "010신규"; }
function discLabel(v){ return v==="gongsi" ? "공시지원금" : "요금할인 25%(선택약정)"; }

function getGongsi(modelCode, tier) {
  return (GONGSI_BY_MODEL?.[modelCode]?.[tier]) ?? 0;
}
function get특판가(특판가Code, tier, joinType) {
  if (!특판가Code) return 0;
  return (특판가_BY_CODE?.[특판가Code]?.[tier]?.[joinType]) ?? 0;
}

let currentTab = "all";
let currentGroupId = null;
let currentVariantId = null;

function closeModal(){
  const m=document.getElementById("modal");
  m.style.display="none";
  m.setAttribute("aria-hidden","true");
  currentGroupId=null; currentVariantId=null;
}
function openModal(){
  const m=document.getElementById("modal");
  m.style.display="block";
  m.setAttribute("aria-hidden","false");
}

function getGroup(groupId) {
  return DEVICES.find(d => d.groupId === groupId);
}
function getVariant(group, variantId) {
  return group.variants.find(v => v.id === variantId) || group.variants[0];
}

function calc(group, variant) {
  const joinType = document.getElementById("joinType").value;
  const months   = Number(document.getElementById("months").value);
  const dType    = document.getElementById("discountType").value;
  const tier     = Number(document.getElementById("planTier").value);
  const isSeonyak = (dType === "seonyak25");

  const 특판가 = get특판가(variant.특판가Code, tier, joinType);
  const gongsi = getGongsi(variant.modelCode, tier);

  const netDevice = isSeonyak ? (variant.msrp - 특판가) : (variant.msrp - gongsi - 특판가);
  const monthlyPlan = isSeonyak ? Math.round(tier * 0.75) : tier;
  const monthlyPhone = pmtEqualPayment(Math.max(0, netDevice), months, APR);
  const total = monthlyPhone + monthlyPlan;
  const totalInterest = (monthlyPhone * months) - netDevice;

  return { joinType, months, dType, tier, 특판가, gongsi, netDevice, monthlyPhone, monthlyPlan, total, totalInterest, isSeonyak };
}

function renderPopup(groupId, variantId) {
  const group = getGroup(groupId);
  const variant = getVariant(group, variantId);
  const r = calc(group, variant);

  currentGroupId = groupId;
  currentVariantId = variant.id;

  const hasCapSelector = group.variants.length > 1;
  const title = hasCapSelector ? `${group.name} (${variant.cap})` : group.name;

  document.getElementById("mTitle").textContent = `${title} 월 납부금(예상)`;
  document.getElementById("mSub").textContent =
    `${group.cat} · ${joinLabel(r.joinType)} · ${discLabel(r.dType)} · 할부 ${r.months}개월 · ${Math.round(r.tier/1000)}K 이상`;

  const warn = document.getElementById("mWarn");
  if (!variant.특판가Code) {
    warn.style.display="block";
    warn.textContent="※ 무선단가표에 특판가 코드가 없어 특판가=0원으로 계산됩니다(필요 시 코드 추가 가능).";
  } else {
    warn.style.display="none";
  }

  const rows = [];

  // 이미지(variantId 기준)
  rows.push(`
    <div class="imgbox" style="height:220px;margin-bottom:10px;">
      <img id="mImg" src="img/${variant.id}.png" alt="${title}" onerror="this.parentElement.style.display='none';" />
    </div>
  `);

  // 용량 선택 (2개 이상일 때만)
  if (hasCapSelector) {
    const options = group.variants.map(v => `<option value="${v.id}" ${v.id===variant.id?'selected':''}>${v.cap}</option>`).join("");
    rows.push(`<div class="row"><span>용량</span><b><select id="capSelect">${options}</select></b></div>`);
  }

  rows.push(`<div class="row"><span>출고가</span><b>${won(variant.msrp)}</b></div>`);

  if (!r.isSeonyak) {
    rows.push(`<div class="row"><span>공시지원금</span><b>-${won(r.gongsi)}</b></div>`);
  } else {
    rows.push(`<div class="row"><span>요금할인</span><b>25% 적용</b></div>`);
  }

  rows.push(`<div class="row"><span>특판가지원(특별지원금)</span><b>-${won(r.특판가)}</b></div>`);
  rows.push(`<div class="row"><span>단말실구매가</span><b>${fmtNetPrice(r.netDevice)}</b></div>`);
  rows.push(`<div class="row"><span>총 할부이자(예상)</span><b>${won(r.totalInterest)}</b></div>`);

  if (group.gift) {
    rows.push(`<div class="row"><span>상품권</span><b>${won(group.gift)}</b></div>`);
  }

  rows.push(`<hr/>`);
  rows.push(`<div class="row"><span>월 할부금</span><b>${won(r.monthlyPhone)}</b></div>`);
  rows.push(`<div class="row"><span>월 통신요금</span><b>${won(r.monthlyPlan)}</b></div>`);

  document.getElementById("mRows").innerHTML = rows.join("");
  document.getElementById("mTotal").textContent = `합계: ${won(r.total)}`;

  const capSel = document.getElementById("capSelect");
  if (capSel) {
    capSel.addEventListener("change", (e) => {
      renderPopup(groupId, e.target.value);
    });
  }
}

function showPopup(groupId) {
  const group=getGroup(groupId);
  renderPopup(groupId, group.variants[0].id);
  openModal();
}

function renderTabs() {
  const tabs = [
    { id:"all", label:"전체" },
    { id:"apple", label:"애플" },
    { id:"foldable", label:"폴더블" },
    { id:"sseries", label:"삼성" },
    { id:"budget", label:"삼성 보급형" },
  ];
  const el = document.getElementById("tabs");
  el.innerHTML = tabs.map(t => `
    <div class="tab ${t.id===currentTab?'active':''}" onclick="setTab('${t.id}')">${t.label}</div>
  `).join("");
}
function setTab(tabId) {
  currentTab = tabId;
  renderTabs();
  renderGrid();
}
window.setTab=setTab;
window.showPopup=showPopup;
window.closeModal=closeModal;

function renderGrid() {
  const grid=document.getElementById("grid");
  const joinType=document.getElementById("joinType").value;
  const tier=Number(document.getElementById("planTier").value);
  const isSeonyak=(document.getElementById("discountType").value==="seonyak25");
  const monthlyPlanForCard=isSeonyak ? Math.round(tier*0.75) : tier;

  const list = (currentTab==="all") ? DEVICES : DEVICES.filter(g => g.tab === currentTab);

  grid.innerHTML = list.map(g => {
    const v = g.variants[0];
    const 특판가 = get특판가(v.특판가Code, tier, joinType);
    const gongsi = getGongsi(v.modelCode, tier);
    const net = isSeonyak ? (v.msrp - 특판가) : (v.msrp - gongsi - 특판가);

    return `
      <div class="card" onclick="showPopup('${g.groupId}')">
        <div class="imgbox">
          <img src="img/${v.id}.png" alt="${g.name}" onerror="this.parentElement.style.display='none';" />
        </div>
        <div class="cat">${g.cat} · ${Math.round(tier/1000)}K 이상 · ${joinLabel(joinType)}</div>
        <div class="name">${g.name}</div>

        <div class="line"><span>월 통신요금</span><span>${won(monthlyPlanForCard)}</span></div>
        ${!isSeonyak ? `<div class="line"><span>공시(요금제별)</span><span>${won(gongsi)}</span></div>` : ``}
        <div class="line"><span>특판가</span><span>${won(특판가)}</span></div>
        <div class="line"><span>실구매가</span><span>${fmtNetPrice(net)}</span></div>

        ${g.gift ? `<div class="pill">상품권 ${won(g.gift)}</div>` : `<div class="pill">${g.variants.length>1 ? "용량 선택 가능" : "눌러서 월납 확인"}</div>`}
      </div>
    `;
  }).join("");
}

function onOptionChange() {
  renderGrid();
  if (currentGroupId && currentVariantId) {
    renderPopup(currentGroupId, currentVariantId);
  }
}
document.getElementById("joinType").addEventListener("change", onOptionChange);
document.getElementById("discountType").addEventListener("change", onOptionChange);
document.getElementById("months").addEventListener("change", onOptionChange);
document.getElementById("planTier").addEventListener("change", onOptionChange);

document.getElementById("modal").addEventListener("click", (e) => {
  if (e.target.id === "modal") closeModal();
});

renderTabs();
renderGrid();
</script>
</body>
</html>
